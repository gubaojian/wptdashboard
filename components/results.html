<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="wpt-results-base">
    <script>
      /**
       * Base class for re-use of results-fetching behaviour, between
       * multi-item (wpt-results) and single-test (test-file-results) views.
       */
      class ResultsBase extends window.Polymer.Element {
        static get is () { return 'wpt-results-base' }

        static get properties () {
          return {
            // URLs for TestRuns to load.
            testRunResources: {
              type: Array
            },
            // Fetched + parsed JSON blobs for the runs
            testRuns: {
              type: Array
            }
          }
        }

        async connectedCallback () {
          super.connectedCallback()

          if (!this.testRuns) {
            const fetches = await Promise.all(
              this.testRunResources.map(async url => {
                const response = await window.fetch(url)
                if (response.status !== 200) {
                  return Promise.resolve()
                }
                return response.json()
              })
            )
            this.testRuns = fetches.filter(e => e)  // Filter unresolved fetches.
          }
        }
      }

      window.customElements.define(ResultsBase.is, ResultsBase)
    </script>
</dom-module>
